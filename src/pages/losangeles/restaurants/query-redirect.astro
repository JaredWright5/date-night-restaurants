---
// This page handles query parameter redirects for neighborhood filtering
export const prerender = false;

// Get URL parameters
const url = new URL(Astro.request.url);
const neighborhood = url.searchParams.get('neighborhood');
const search = url.searchParams.get('search');
const cuisine = url.searchParams.get('cuisine');
const price = url.searchParams.get('price');
const dateScore = url.searchParams.get('dateScore');

console.log('Query redirect page - URL:', url.toString());
console.log('neighborhood:', neighborhood);
console.log('search:', search);
console.log('cuisine:', cuisine);
console.log('price:', price);
console.log('dateScore:', dateScore);

// If there's a neighborhood filter, redirect to the new URL structure
if (neighborhood && neighborhood.trim() !== '') {
  const neighborhoodSlug = neighborhood.toLowerCase().replace(/\s+/g, '-');
  console.log('Redirecting to:', `/losangeles/restaurants/${neighborhoodSlug}/`);
  return Astro.redirect(`/losangeles/restaurants/${neighborhoodSlug}/`, 301);
}

// If there are other filters, redirect to the main page with filters
if (search || cuisine || price || dateScore) {
  const params = new URLSearchParams();
  if (search) params.set('search', search);
  if (cuisine) params.set('cuisine', cuisine);
  if (price) params.set('price', price);
  if (dateScore) params.set('dateScore', dateScore);
  
  const queryString = params.toString();
  console.log('Redirecting to main page with filters:', `/losangeles/restaurants/?${queryString}`);
  return Astro.redirect(`/losangeles/restaurants/?${queryString}`, 301);
}

// If no filters, redirect to main page
console.log('No filters, redirecting to main page');
return Astro.redirect('/losangeles/restaurants/', 301);
---
